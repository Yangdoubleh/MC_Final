<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript">
	$(document).ready(function(){
		window.SpeechRecognition=window.SpeechRecongnition ||
		window.webkitSpeechRecognition;
		const recognition= new SpeechRecognition();
		
		recognition.inerimResults=true;
		recognition.addEventListener("result",function(e){
			$("textarea").val(e.results[0][0].transcript);
		});		
		
		//마이크 on
		$("#mic").click(function(){
			$("#mic").attr("src","img/mic_on_small.png");
			recognition.start();
			setTimeout(function(){
				$("#mic").attr("src","img/mic_off_small.png");
				recognition.stop();				
				const ingredient = $("textarea").val();
				
				//식재료 API 사용
				$.get("receipeSearch",{ingredient}, function(foodrecommand){
					let foodLink = [];
					
					//랜덤 숫자 생성
					let randomIndexArray = [];
					for (var i=0; i<5; i++){
						randomNum = Math.floor(Math.random()*19);
						if (randomIndexArray.indexOf(randomNum) == -1) {
							randomIndexArray.push(randomNum);
						}
						else i--;
					}
					
					//List로 만들어서 URL 저장, 이름 한글로 변환
					for (var i=0; i<5; i++) {
					foodLink[i] = JSON.parse(foodrecommand).hits[randomIndexArray[i]].recipe.url;
					}
					

					//Food Recommand 화면 띄우기
					for (var i=0; i<5; i++) {
						console.log(foodNameKr);
						const foodName = JSON.parse(foodrecommand).hits[randomIndexArray[i]].recipe.label;
						const foodImage = JSON.parse(foodrecommand).hits[randomIndexArray[i]].recipe.images.REGULAR.url;
						const foodKcal = JSON.parse(foodrecommand).hits[randomIndexArray[i]].recipe.totalNutrients.ENERC_KCAL.quantity.toFixed(1);
						const foodFat = JSON.parse(foodrecommand).hits[randomIndexArray[i]].recipe.totalNutrients.FAT.quantity.toFixed(1);
						const foodProt = JSON.parse(foodrecommand).hits[randomIndexArray[i]].recipe.totalNutrients.PROCNT.quantity.toFixed(1);
						const foodCarbs = JSON.parse(foodrecommand).hits[randomIndexArray[i]].recipe.totalNutrients.CHOCDF.quantity.toFixed(1);
						$("#foodDiv"+i).html("<h2>"+foodName[i]+"</h2><br><img src='"+foodImage+"'><button id='recipeBtn"+i+"'>레시피 보기</button><button id='BasketBtn"+i+"'>장바구니 넣기</button><h4>칼로리 : "+foodKcal+" kcal</h4><h4>탄수화물 : "+foodCarbs+" g</h4><h4>단백질 : "+foodProt+" g</h4><h4>지방 : "+foodFat+" g</h4>");
						document.getElementById('foodDiv'+i).style.border='3px solid #0A0A0A';
						document.getElementById('foodDiv'+i).style.background='#f5f5f5';
						document.getElementById('foodDiv'+i).style.width='380px';
						document.getElementById('foodDiv'+i).style.height='auto';
					}
					$(document).on('click',"#recipeBtn0",function(){
						window.open(foodLink[0]);
					});
					$(document).on('click',"#recipeBtn1",function(){
						window.open(foodLink[1]);
					});
					$(document).on('click',"#recipeBtn2",function(){
						window.open(foodLink[2]);
					});
					$(document).on('click',"#recipeBtn3",function(){
						window.open(foodLink[3]);
					});
					$(document).on('click',"#recipeBtn4",function(){
						window.open(foodLink[4]);
					});
				});
			}, 3000);
		});
	});
		</script>
</head>
<body>
<center>
		마이크를 누르고 3초간 말하세요<img src="img/mic_off_small.png" id="mic" width=><br>
		<textarea rows="2" cols="50"></textarea>
		<div id="foodDiv0"></div><br>
		<div id="foodDiv1"></div><br>
		<div id="foodDiv2"></div><br>
		<div id="foodDiv3"></div><br>
		<div id="foodDiv4"></div>
	</center>
</body>
</html>